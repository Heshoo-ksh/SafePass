@page "/"
@using MudBlazor
@using SafePass.Services
@using SafePass.Data
@inject ISnackbar Snackbar
@inject LoginService loginService

@using DataLogin = SafePass.Data.Login

<PageTitle>Index</PageTitle>

<h1>Welcome to your SafePass Vault.</h1>

@code {
     private PasswordStrengthSubject _passwordSubject = new PasswordStrengthSubject();
     private List<DataLogin> _logins = new List<DataLogin>();

     protected override async Task OnInitializedAsync()
     {
          // Attach the password strength observer
          _passwordSubject.Attach(new PasswordStrengthObserver((message, severity) =>
          {
               PasswordStrengthNotifier.ShowNotification(Snackbar, message, severity);
          }));

          // Fetch all login records
          _logins = (await loginService.GetAllLogins()).ToList();

          // Evaluate password strength for each login
          foreach (var login in _logins)
          {
               if (!string.IsNullOrEmpty(login.Password))
               {
                    _passwordSubject.Notify(login);
               }
          }
     }
}
